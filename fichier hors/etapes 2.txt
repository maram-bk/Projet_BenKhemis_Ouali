4) Auth service + Guard
src/app/services/auth.service.ts
import { Injectable } from '@angular/core';
import { Router } from '@angular/router';

@Injectable({
  providedIn: 'root'
})
export class AuthService {
  private adminEmail = 'admin@heritage.tn';
  private adminPassword = 'admin123';

  constructor(private router: Router) {}

  login(email: string, password: string): boolean {
    if (email === this.adminEmail && password === this.adminPassword) {
      localStorage.setItem('isLoggedIn', 'true');
      localStorage.setItem('adminEmail', email);
      return true;
    }
    return false;
  }

  logout(): void {
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('adminEmail');
    this.router.navigate(['/admin/login']);
  }

  isAuthenticated(): boolean {
    return localStorage.getItem('isLoggedIn') === 'true';
  }

  getAdminEmail(): string | null {
    return localStorage.getItem('adminEmail');
  }
}

src/app/guards/auth.guard.ts
import { Injectable } from '@angular/core';
import { CanActivate, Router } from '@angular/router';
import { AuthService } from '../services/auth.service';

@Injectable({
  providedIn: 'root'
})
export class AuthGuard implements CanActivate {
  constructor(private auth: AuthService, private router: Router) {}

  canActivate(): boolean {
    if (this.auth.isAuthenticated()) {
      return true;
    }
    this.router.navigate(['/admin/login']);
    return false;
  }
}

5) Routing — app-routing.module.ts

src/app/app-routing.module.ts

import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';

// Front
import { ListComponent } from './pages/front/list/list.component';
import { DetailComponent } from './pages/front/detail/detail.component';
import { AboutComponent } from './pages/front/about/about.component';

// Admin
import { LoginComponent } from './pages/admin/login/login.component';
import { DashboardComponent } from './pages/admin/dashboard/dashboard.component';
import { AddComponent } from './pages/admin/add/add.component';
import { EditComponent } from './pages/admin/edit/edit.component';

// Guard
import { AuthGuard } from './guards/auth.guard';

const routes: Routes = [
  { path: '', redirectTo: '/front/list', pathMatch: 'full' },

  // front
  { path: 'front/list', component: ListComponent },
  { path: 'front/detail/:id', component: DetailComponent },
  { path: 'front/about', component: AboutComponent },

  // admin
  { path: 'admin/login', component: LoginComponent },
  { path: 'admin/dashboard', component: DashboardComponent, canActivate: [AuthGuard] },
  { path: 'admin/add', component: AddComponent, canActivate: [AuthGuard] },
  { path: 'admin/edit/:id', component: EditComponent, canActivate: [AuthGuard] },

  { path: '**', redirectTo: '/front/list' }
];


7) App layout — src/app/app.component.html
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" routerLink="/front/list">Héritage Antique TN</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link" routerLink="/front/list">Liste</a></li>
        <li class="nav-item"><a class="nav-link" routerLink="/front/about">À propos</a></li>
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" routerLink="/admin/login">Admin</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <router-outlet></router-outlet>
</div>

8) Composants principaux (exemples complets)

Note : crée les composants avec ng generate component pages/front/list etc. puis remplace leurs fichiers par les codes ci-dessous.

A) ListComponent

src/app/pages/front/list/list.component.ts

import { Component, OnInit } from '@angular/core';
import { SiteService } from '../../../services/site.service';
import { SiteArcheologique } from '../../../models/site-archeologique';

@Component({
  selector: 'app-list',
  templateUrl: './list.component.html',
  styleUrls: ['./list.component.css']
})
export class ListComponent implements OnInit {
  sites: SiteArcheologique[] = [];
  filtered: SiteArcheologique[] = [];
  searchName = '';
  maxPrice: number | null = null;

  constructor(private siteService: SiteService) {}

  ngOnInit(): void {
    this.load();
  }

  load(): void {
    this.siteService.getAll().subscribe(s => {
      this.sites = s;
      this.filtered = s;
    });
  }

  applyFilter(): void {
    this.filtered = this.sites.filter(site => {
      const byName = this.searchName ? site.nom.toLowerCase().startsWith(this.searchName.toLowerCase()) : true;
      const byPrice = this.maxPrice !== null && this.maxPrice !== undefined ? site.prixEntree <= this.maxPrice : true;
      return byName && byPrice;
    });
  }

  clearFilter(): void {
    this.searchName = '';
    this.maxPrice = null;
    this.filtered = [...this.sites];
  }
}


src/app/pages/front/list/list.component.html

<div class="mb-3">
  <form class="row g-2" (ngSubmit)="applyFilter()">
    <div class="col-md-5">
      <input class="form-control" placeholder="Recherche par nom (commence par...)" [(ngModel)]="searchName" name="searchName">
    </div>
    <div class="col-md-3">
      <input type="number" class="form-control" placeholder="Prix max" [(ngModel)]="maxPrice" name="maxPrice">
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100" type="button" (click)="applyFilter()">Filtrer</button>
    </div>
    <div class="col-md-2">
      <button class="btn btn-secondary w-100" type="button" (click)="clearFilter()">Réinitialiser</button>
    </div>
  </form>
</div>

<div class="row">
  <div class="col-md-4 mb-4" *ngFor="let site of filtered">
    <div class="card h-100">
      <img [src]="site.photo" class="card-img-top" [alt]="site.nom" style="height:200px; object-fit:cover;">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title">{{ site.nom }}</h5>
        <p class="card-text">{{ site.descriptionCourte }}</p>
        <p class="mb-1"><strong>Gouvernorat:</strong> {{ site.gouvernorat }}</p>
        <p class="mb-2"><strong>Prix:</strong> {{ site.prixEntree }} DT</p>
        <div class="mt-auto">
          <a [routerLink]="['/front/detail', site.id]" class="btn btn-primary w-100">Voir le détail</a>
        </div>
      </div>
    </div>
  </div>
</div>

B) DetailComponent

src/app/pages/front/detail/detail.component.ts

import { Component, OnInit } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { SiteService } from '../../../services/site.service';
import { SiteArcheologique } from '../../../models/site-archeologique';

@Component({
  selector: 'app-detail',
  templateUrl: './detail.component.html'
})
export class DetailComponent implements OnInit {
  site: SiteArcheologique | null = null;
  newComment = { nom: '', message: '', note: 5 };

  constructor(
    private route: ActivatedRoute,
    private siteService: SiteService,
    private router: Router
  ) {}

  ngOnInit(): void {
    const id = this.route.snapshot.paramMap.get('id')!;
    if (id) {
      this.siteService.getById(id).subscribe(s => this.site = s);
    }
  }

  addComment(): void {
    if (!this.site) return;
    const comment = {
      nom: this.newComment.nom || 'Anonyme',
      message: this.newComment.message,
      note: this.newComment.note,
      date: new Date().toISOString().split('T')[0]
    };
    this.site.comments = this.site.comments || [];
    this.site.comments.push(comment);
    // Update on server
    this.siteService.update(this.site).subscribe(() => {
      this.newComment = { nom: '', message: '', note: 5 };
    });
  }

  goBack(): void {
    this.router.navigate(['/front/list']);
  }
}


src/app/pages/front/detail/detail.component.html

<div *ngIf="site">
  <div class="row">
    <div class="col-md-6">
      <img [src]="site.photo" class="img-fluid" [alt]="site.nom" style="max-height:400px; object-fit:cover;">
    </div>
    <div class="col-md-6">
      <h2>{{ site.nom }}</h2>
      <p><strong>Localisation:</strong> {{ site.localisation }} ({{ site.gouvernorat }})</p>
      <p><strong>Horaires:</strong> {{ site.horaires }}</p>
      <p><strong>Prix d'entrée:</strong> {{ site.prixEntree }} DT</p>
      <p>{{ site.descriptionCourte }}</p>

      <div *ngIf="site.descriptionDetaillee?.length">
        <h5>Détails historiques</h5>
        <div *ngFor="let d of site.descriptionDetaillee">
          <p><strong>{{ d.nom }}</strong> — {{ d.periodeHistorique }} — découvert le {{ d.dateDecouverte }}</p>
          <p>Musée sur place : {{ d.possedeMusee ? 'Oui' : 'Non' }}</p>
        </div>
      </div>
    </div>
  </div>

  <hr>

  <h4>Commentaires</h4>
  <div *ngIf="site.comments?.length; else noComments">
    <div *ngFor="let c of site.comments" class="mb-3">
      <strong>{{ c.nom }}</strong> — <small>{{ c.date }}</small>
      <div>Note: {{ c.note }}/5</div>
      <p>{{ c.message }}</p>
    </div>
  </div>
  <ng-template #noComments>
    <p>Aucun commentaire pour le moment.</p>
  </ng-template>

  <div class="card p-3 mt-3">
    <h5>Laisser un commentaire</h5>
    <div class="mb-2">
      <input class="form-control" placeholder="Nom" [(ngModel)]="newComment.nom" name="nom">
    </div>
    <div class="mb-2">
      <textarea class="form-control" placeholder="Message" [(ngModel)]="newComment.message" name="message"></textarea>
    </div>
    <div class="mb-2">
      <label>Note</label>
      <select class="form-select" [(ngModel)]="newComment.note" name="note">
        <option *ngFor="let n of [5,4,3,2,1]" [value]="n">{{n}}</option>
      </select>
    </div>
    <button class="btn btn-success" (click)="addComment()">Publier</button>
    <button class="btn btn-secondary ms-2" (click)="goBack()">Retour</button>
  </div>
</div>

C) LoginComponent

src/app/pages/admin/login/login.component.ts

import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { AuthService } from '../../../services/auth.service';

@Component({
  selector: 'app-login',
  templateUrl: './login.component.html'
})
export class LoginComponent {
  email = '';
  password = '';
  error = '';

  constructor(private auth: AuthService, private router: Router) {}

  onLogin(): void {
    if (this.auth.login(this.email, this.password)) {
      this.router.navigate(['/admin/dashboard']);
    } else {
      this.error = 'Email ou mot de passe incorrect';
    }
  }
}


src/app/pages/admin/login/login.component.html

<div class="row justify-content-center">
  <div class="col-md-4">
    <div class="card p-4">
      <h4 class="text-center mb-3">Connexion administrateur</h4>
      <div class="mb-3">
        <label>Email</label>
        <input type="email" class="form-control" [(ngModel)]="email" name="email">
      </div>
      <div class="mb-3">
        <label>Mot de passe</label>
        <input type="password" class="form-control" [(ngModel)]="password" name="password">
      </div>
      <button class="btn btn-dark w-100" (click)="onLogin()">Se connecter</button>
      <div *ngIf="error" class="alert alert-danger mt-2">{{ error }}</div>
      <div class="mt-2 text-muted small">Email: admin@heritage.tn / Mot de passe: admin123</div>
    </div>
  </div>
</div>

D) DashboardComponent

src/app/pages/admin/dashboard/dashboard.component.ts

import { Component, OnInit } from '@angular/core';
import { SiteService } from '../../../services/site.service';
import { SiteArcheologique } from '../../../models/site-archeologique';
import { AuthService } from '../../../services/auth.service';
import { Router } from '@angular/router';

@Component({
  selector: 'app-dashboard',
  templateUrl: './dashboard.component.html'
})
export class DashboardComponent implements OnInit {
  sites: SiteArcheologique[] = [];

  constructor(
    private siteService: SiteService,
    private auth: AuthService,
    private router: Router
  ) {}

  ngOnInit(): void {
    this.load();
  }

  load(): void {
    this.siteService.getAll().subscribe(s => this.sites = s);
  }

  deleteSite(id: string): void {
    if (!confirm('Voulez-vous supprimer ce site ?')) return;
    this.siteService.delete(id).subscribe(() => this.load());
  }

  logout(): void {
    this.auth.logout();
  }
}


src/app/pages/admin/dashboard/dashboard.component.html

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Dashboard Admin</h3>
  <div>
    <button class="btn btn-secondary me-2" routerLink="/admin/add">Ajouter un site</button>
    <button class="btn btn-danger" (click)="logout()">Déconnexion</button>
  </div>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Nom</th>
      <th>Gouvernorat</th>
      <th>Prix</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let s of sites">
      <td>{{ s.nom }}</td>
      <td>{{ s.gouvernorat }}</td>
      <td>{{ s.prixEntree }} DT</td>
      <td>
        <a [routerLink]="['/admin/edit', s.id]" class="btn btn-sm btn-primary me-2">Modifier</a>
        <button class="btn btn-sm btn-danger" (click)="deleteSite(s.id)">Supprimer</button>
      </td>
    </tr>
  </tbody>
</table>

E) AddComponent (formulaire basique)

src/app/pages/admin/add/add.component.ts

import { Component } from '@angular/core';
import { Router } from '@angular/router';
import { SiteService } from '../../../services/site.service';
import { SiteArcheologique } from '../../../models/site-archeologique';
import { v4 as uuidv4 } from 'uuid';

@Component({
  selector: 'app-add',
  templateUrl: './add.component.html'
})
export class AddComponent {
  site: Partial<SiteArcheologique> = {
    descriptionDetaillee: [],
    comments: []
  };

  constructor(private siteService: SiteService, private router: Router) {}

  save(): void {
    const newSite: SiteArcheologique = {
      id: this.site.id || 'site-' + Date.now(),
      nom: this.site.nom || '',
      localisation: this.site.localisation || '',
      gouvernorat: this.site.gouvernorat || '',
      photo: this.site.photo || '',
      prixEntree: this.site.prixEntree || 0,
      descriptionCourte: this.site.descriptionCourte || '',
      descriptionDetaillee: this.site.descriptionDetaillee || [],
      horaires: this.site.horaires || '',
      comments: this.site.comments || []
    };

    this.siteService.add(newSite).subscribe(() => {
      this.router.navigate(['/admin/dashboard']);
    });
  }
}


src/app/pages/admin/add/add.component.html

<div class="card p-3">
  <h4>Ajouter un site</h4>
  <div class="mb-2">
    <label>Nom</label>
    <input class="form-control" [(ngModel)]="site.nom" name="nom">
  </div>
  <div class="mb-2">
    <label>Localisation</label>
    <input class="form-control" [(ngModel)]="site.localisation" name="localisation">
  </div>
  <div class="mb-2">
    <label>Gouvernorat</label>
    <input class="form-control" [(ngModel)]="site.gouvernorat" name="gouvernorat">
  </div>
  <div class="mb-2">
    <label>Photo (chemin)</label>
    <input class="form-control" [(ngModel)]="site.photo" name="photo">
  </div>
  <div class="mb-2">
    <label>Prix entrée</label>
    <input type="number" class="form-control" [(ngModel)]="site.prixEntree" name="prixEntree">
  </div>
  <div class="mb-2">
    <label>Horaires</label>
    <input class="form-control" [(ngModel)]="site.horaires" name="horaires">
  </div>
  <div class="mb-2">
    <label>Description courte</label>
    <textarea class="form-control" [(ngModel)]="site.descriptionCourte" name="descriptionCourte"></textarea>
  </div>
  <div class="d-flex gap-2">
    <button class="btn btn-success" (click)="save()">Enregistrer</button>
    <button class="btn btn-secondary" routerLink="/admin/dashboard">Annuler</button>
  </div>
</div>


Pour EditComponent : réutilise le formulaire d’AddComponent en pré-remplissant avec getById() et en appelant update().

9) Installer json-server & lancer

Depuis la racine du projet (là où se trouve db.json) :

npm install -g json-server   # ou utiliser npx
json-server --watch db.json --port 3000
# ou
npx json-server --watch db.json --port 3000


API disponíveis:

http://localhost:3000/sites

http://localhost:3000/sites/site-eljeme

10) Démarrer Angular

Dans un autre terminal :

ng serve


Ouvre http://localhost:4200.