@if (site) {
<div class="row">
    <div class="col-md-6">
        <img [src]="site.photo" alt="" class="img-fluid" style="max-height:4400px;object-fit: cover;">
    </div>
    <div class="col-md-6">
        <h2>{{site.nom}}</h2>
        <p><strong>Localisation: </strong>{{site.localisation}} ({{site.gouvernorat}})</p>
        <div class="hours-box"></div>
        <span class="label">Heures: {{site.horaires}}</span>
        <span [class.open]="isOpen" [class.closed]="!isOpen">
            {{isOpen ? 'Ouvert' : 'Fermé'}}
        </span>
        <p><strong>Prix d'entrée: </strong>{{site.prixEntree}} DT</p>
        <p>{{site.descriptionCourte}}</p>
        @if (site.descriptionDetaillee?.length) {
        <h5>Détails Historiques</h5>
        @for (d of site.descriptionDetaillee; track $index) {
        <p>
            <strong>{{d.nom}}</strong>
            - {{d.periodeHistorique}}
            - découvert le {{d.dateDecouverte}}
        </p>
        <p [class]="{
                    'text-success' : d.possedeMusee,
                    'text-danger' : !d.possedeMusee
                }">Musée sur place : {{d.possedeMusee ? 'Oui' : 'Non'}}</p>
        <a routerLink="/front/reservation" class="btn btn-primary">Réserver Visite</a>
        }
        }
    </div>
</div>
<hr>
<h4>Commentaires</h4>
@if (site.comments?.length) {
@for (c of site.comments; track $index) {
<div class="mb-3">
    <strong>{{c.nom}}</strong> - <small>{{c.date | date : 'dd-MM-yyyy'}}</small>
    <div>Note: {{c.note | starcomment}}</div>
    <p>{{c.message}}</p>
</div>
 <div class="d-flex gap-2">
    <button type="button" class="btn btn-outline-primary btn-sm" (click)="onEditComment($index)">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
        <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325"/>
      </svg>
    </button>
    <button type="button" class="btn btn-outline-danger btn-sm" (click)="onDeleteComment($index)">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
        <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47M8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5"/>
      </svg>
    </button>
  </div>
}
}
@else {
<p>Aucun commentaires pour le moment.</p>
}


<button class="btn btn-primary" (click)="onShowComments()">Ajouter un commentaire</button>
@if (showComment) {
<div class="card p-3 mt-3">
    <h5>Laisser un commentaire</h5>
    <form [formGroup]="commentForm">
        <div class="mb-2">
            <input class="form-control" formControlName="nom" placeholder="Nom">
        </div>
        <div class="mb-2">
            <textarea class="form-control" formControlName="message" placeholder="Message"></textarea>
        </div>
        <div class="mb-2">
            <label>Note</label>
            <div class="star-rating">
                @for (n of [1,2,3,4,5]; track n) {
                <span (click)="commentForm.get('note')?.setValue(n)"
                    [class.filled]="n <= commentForm.get('note')?.value" class="star">&#9733;</span>
                }
            </div>
        </div>
        <div class="col-md-2">
            <button class="btn btn-success" (click)="onAddComment()">Publier</button>
        </div>
    </form>
</div>
}
<button class="btn btn-secondary ms-2" (click)="onBack()">Retour</button>
}